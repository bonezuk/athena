//-------------------------------------------------------------------------------------------
#ifndef __ORCUS_ENGINE_BLACKOMEGA_SUBBAND_H
#define __ORCUS_ENGINE_BLACKOMEGA_SUBBAND_H
//-------------------------------------------------------------------------------------------

#include "engine/blackomega/inc/Hybrid.h"

//-------------------------------------------------------------------------------------------
namespace orcus
{
namespace engine
{
namespace blackomega
{
//-------------------------------------------------------------------------------------------
#if defined(SINGLE_FLOAT_SAMPLE)
//-------------------------------------------------------------------------------------------

#define MAX_CEILING 65536.0f

#define D4_1_1    0.92387953251128676f
#define D4_1_2   -0.38268343236508977f
#define D4_1_3    0.70710678118654752f
#define D4_2_1    1.84775906502257352f
#define D4_2_2   -0.76536686473017954f
#define D4_2_3    1.41421356237309504f

#define D8_1_1    0.98078528040323045f
#define D8_1_2    0.55557023301960222f
#define D8_1_3   -0.19509032201612827f
#define D8_1_4   -0.83146961230254524f
#define D8_2_1    1.96157056080646090f
#define D8_2_2    1.11114046603920444f
#define D8_2_3   -0.39018064403225654f
#define D8_2_4   -1.66293922460509048f

#define D16_1_1	  0.99518472667219689f
#define D16_1_2	  0.88192126434835503f
#define D16_1_3	  0.63439328416364550f
#define D16_1_4   0.29028467725446236f
#define D16_1_5  -0.09801714032956060f
#define D16_1_6  -0.47139673682599765f
#define D16_1_7  -0.77301045336273696f
#define D16_1_8  -0.95694033573220886f
#define D16_2_1   1.99036945334439378f
#define D16_2_2   1.76384252869671006f
#define D16_2_3   1.26878656832729100f
#define D16_2_4   0.58056935450892472f
#define D16_2_5  -0.19603428065912120f
#define D16_2_6  -0.94279347365199530f
#define D16_2_7  -1.54602090672547392f
#define D16_2_8  -1.91388067146441772f

#define D32_1_1   0.99879545620517241f
#define D32_1_2   0.97003125319454397f
#define D32_1_3	  0.90398929312344334f
#define D32_1_4	  0.80320753148064494f
#define D32_1_5	  0.67155895484701844f
#define D32_1_6	  0.51410274419322166f
#define D32_1_7	  0.33688985339222005f
#define D32_1_8	  0.14673047445536175f
#define D32_1_9	 -0.04906767432741801f
#define D32_1_10 -0.24298017990326387f
#define D32_1_11 -0.42755509343028186f
#define D32_1_12 -0.59569930449243336f
#define D32_1_13 -0.74095112535495888f
#define D32_1_14 -0.85772861000027201f
#define D32_1_15 -0.94154406518302070f
#define D32_1_16 -0.98917650996478101f

//-------------------------------------------------------------------------------------------
#else
//-------------------------------------------------------------------------------------------

#define MAX_CEILING 65536.0

#define D4_1_1    0.92387953251128676
#define D4_1_2   -0.38268343236508977
#define D4_1_3    0.70710678118654752
#define D4_2_1    1.84775906502257352
#define D4_2_2   -0.76536686473017954
#define D4_2_3    1.41421356237309504

#define D8_1_1    0.98078528040323045
#define D8_1_2    0.55557023301960222
#define D8_1_3   -0.19509032201612827
#define D8_1_4   -0.83146961230254524
#define D8_2_1    1.96157056080646090
#define D8_2_2    1.11114046603920444
#define D8_2_3   -0.39018064403225654
#define D8_2_4   -1.66293922460509048

#define D16_1_1	  0.99518472667219689
#define D16_1_2	  0.88192126434835503
#define D16_1_3	  0.63439328416364550
#define D16_1_4   0.29028467725446236
#define D16_1_5  -0.09801714032956060
#define D16_1_6  -0.47139673682599765
#define D16_1_7  -0.77301045336273696
#define D16_1_8  -0.95694033573220886
#define D16_2_1   1.99036945334439378
#define D16_2_2   1.76384252869671006
#define D16_2_3   1.26878656832729100
#define D16_2_4   0.58056935450892472
#define D16_2_5  -0.19603428065912120
#define D16_2_6  -0.94279347365199530
#define D16_2_7  -1.54602090672547392
#define D16_2_8  -1.91388067146441772

#define D32_1_1   0.99879545620517241
#define D32_1_2   0.97003125319454397
#define D32_1_3	  0.90398929312344334
#define D32_1_4	  0.80320753148064494
#define D32_1_5	  0.67155895484701844
#define D32_1_6	  0.51410274419322166
#define D32_1_7	  0.33688985339222005
#define D32_1_8	  0.14673047445536175
#define D32_1_9	 -0.04906767432741801
#define D32_1_10 -0.24298017990326387
#define D32_1_11 -0.42755509343028186
#define D32_1_12 -0.59569930449243336
#define D32_1_13 -0.74095112535495888
#define D32_1_14 -0.85772861000027201
#define D32_1_15 -0.94154406518302070
#define D32_1_16 -0.98917650996478101

//-------------------------------------------------------------------------------------------
#endif
//-------------------------------------------------------------------------------------------

class BLACKOMEGA_EXPORT Subband
{
	public:
	
		typedef void (*DCTFunc)(sample_t *,sample_t *,sample_t *,sample_t *);
		typedef void (*WindowFunc)(sample_t *,tint,sample_t *);
	
	public:
		Subband();
		~Subband();
		
		static void start();
		static void stop();
		
		void synthesis(sample_t *bandPtr,sample_t *samples);
		
		void reset();
		
	protected:

		static common::Allocation *m_subbandAlloc;
		static sample_t *m_decWindowA;
		static sample_t *m_decWindowB;
		
		common::Allocation m_alloc;
		
		DCTFunc m_dctFunction;
		WindowFunc m_windowFunction;
		
		tint m_bo;
		sample_t *m_synthBuffs;
		sample_t *m_dBuffer;
		
		void init();
		
		static void makeDecodeTables(tint scaleval);
		static void freeDecodeTables();
		
		static void dct(sample_t *aOut,sample_t *bOut,sample_t *inMem,sample_t *y);
		static void window(sample_t *b0,tint bo1,sample_t *samples);
};

//-------------------------------------------------------------------------------------------
} // namespace blackomega
} // namespace engine
} // namespace orcus
//-------------------------------------------------------------------------------------------
#endif
//-------------------------------------------------------------------------------------------

